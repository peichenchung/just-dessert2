<%= link_to "全部甜點", root_path %>
<% @categories.each do |category| %>
  <%= link_to category.area, category_path(category) %>
<% end %>
<%= link_to "新募資", new_dessert_path %>

<%= render partial: "shared/dessert" %>

<hr>

<script type="text/javascript">
  function initMap() {
    var loaction;
    var geocoder = new google.maps.Geocoder();
    "<% if @category.area == "北部" %>"
      var initmap = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 25.047781, lng: 121.517031},// 初始地圖以臺北火車站為中心
        zoom: 13
      });
    "<% elsif @category.area == "南部" %>"
      var initmap = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 22.639761, lng: 120.302107},// 初始地圖以高雄火車站為中心
        zoom: 13
      });
    "<% elsif @category.area == "中部" %>"
      var initmap = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 24.137295, lng: 120.686764},// 初始地圖以臺中火車站為中心
        zoom: 13
      });
    "<% end %>"



    var icon = {
      url: 'https://image.flaticon.com/icons/svg/135/135578.svg', // url
      scaledSize: new google.maps.Size(50, 50) // scaled size

    };

    //geocoder主程式
    "<% @desserts.each do |dessert| %>"
      geocoder.geocode( { 'address': "<%= dessert.location %>"}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          var marker = new google.maps.Marker({
            map: initmap,
            animation: google.maps.Animation.BOUNCE,
            position: results[0].geometry.location,
            icon: icon,
            title: "<%= dessert.location %>"
          });
        } else {
          alert("Geocode was not successful for the following reason: " + status);
        }
      });
    "<% end %>"
  }
</script>

<script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBg1YAvzj1UR6oFWo_xjOgr2xp56OPSdJo&callback=initMap">
</script>
